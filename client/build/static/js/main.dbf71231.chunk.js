(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{189:function(e,t,n){},190:function(e,t,n){},285:function(e,t,n){"use strict";n.r(t);var s=n(0),a=n.n(s),c=n(29),r=n.n(c),i=(n(189),n(27)),o=n.n(i),u=n(36),l=n(21),j=(n(190),n(74)),b=n.n(j);function d(e,t){var n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if("string"===typeof t&&(t=t.split(".")),!e)return s;for(n=0;n<t.length&&(e=e[t[n]]);n++);return n===t.length?void 0===e?s:e:s}var h=function(e){return e.then((function(e){return[null,e]})).catch((function(e){return[e,null]}))},O="/api/",f=function(e){return function(t){return e?t.data:t}},m=function(e){return function(t){throw 401===d(t,["response","data","code"])&&d(t,"/api/user/validate"!==["response","config","url"])&&(window.location.href="/",localStorage.setItem("rms_token","")),e?t.response.data:t}},p=function(e){return{headers:e}},g=function(e,t){return{get:function(n){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(b.a.get("".concat(t).concat(n),p(s)).then(f(e)).catch(m(e)))},post:function(n,s){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return h(b.a.post("".concat(t).concat(n),s,p(a)).then(f(e)).catch(m(e)))},put:function(n,s){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return h(b.a.put("".concat(t).concat(n),s,p(a)).then(f(e)).catch(m(e)))},patch:function(n,s){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return h(b.a.patch("".concat(t).concat(n),s,p(a)).then(f(e)).catch(m(e)))},del:function(n){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(b.a.delete("".concat(t).concat(n),p(s)).then(f(e)).catch(m(e)))},head:function(e,n){return h(b.a.head("".concat(t).concat(e),p(n)).then(f(!1)).catch(m(!1)))}}},x=g(!0,O),v=(g(!1,O),g(!0,""),n(60)),k=n(28),y=n(25),w=n(178),S=n(292),C=n(294),I=n(288),A=n(289),U=n(37),P=n(6),H=function(e){var t=e.children,n=e.title;return Object(P.jsxs)(I.a,{children:[Object(P.jsxs)(A.a,{span:6,offset:9,style:{paddingTop:150},children:[Object(P.jsx)("h1",{style:{textAlign:"center"},children:n}),t]}),Object(P.jsx)(A.a,{span:12,offset:6,children:Object(P.jsx)("img",{src:"/background.jpg",style:{width:"100%"}})})]})},T={labelCol:{span:8},wrapperCol:{span:24}},E={wrapperCol:{span:24}},N=function(){var e=Object(u.a)(o.a.mark((function e(t,n,s){var a,c,r,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.post("users/login/",t);case 2:if(a=e.sent,c=Object(l.a)(a,2),r=c[0],i=c[1],!r){e.next=8;break}return e.abrupt("return",w.b.error(r.msg||r.error.msg||"Something went wrong"));case 8:w.b.success("User ".concat(i.user.username," has logged in successfully")),localStorage.setItem("auth-token",i.token),s(i.user),i.user.isAdmin?n.push("/admin"):n.push("/user-dashboard");case 12:case"end":return e.stop()}}),e)})));return function(t,n,s){return e.apply(this,arguments)}}(),_=function(e){var t=e.setUser,n=Object(k.g)();return Object(P.jsx)(H,{title:"Welcome",children:Object(P.jsxs)(S.a,Object(y.a)(Object(y.a)({},T),{},{name:"basic",initialValues:{remember:!0},onFinish:function(e){return N(e,n,t)},layout:"vertical",children:[Object(P.jsx)(S.a.Item,{label:"Username",name:"username",rules:[{required:!0,message:"Please input your username!"}],children:Object(P.jsx)(C.a,{placeholder:"enter the username"})}),Object(P.jsx)(S.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}],children:Object(P.jsx)(C.a.Password,{placeholder:"enter the password"})}),Object(P.jsx)(S.a.Item,Object(y.a)(Object(y.a)({},E),{},{children:Object(P.jsxs)(I.a,{children:[Object(P.jsx)(A.a,{span:12,children:Object(P.jsx)(U.a,{type:"primary",htmlType:"submit",block:!0,children:"Login"})}),Object(P.jsx)(A.a,{span:12,children:Object(P.jsx)(v.b,{to:"/signup",children:Object(P.jsx)(U.a,{block:!0,children:"Register"})})})]})}))]}))})},L={labelCol:{span:8},wrapperCol:{span:24}},F={wrapperCol:{span:24}},M=function(){var e=Object(u.a)(o.a.mark((function e(t){var n,s,a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.post("users/",t);case 2:if(n=e.sent,s=Object(l.a)(n,2),a=s[0],c=s[1],!a){e.next=8;break}return e.abrupt("return",w.b.error(a.msg||a.error.msg||"Something went wrong"));case 8:w.b.success("User ".concat(c.newUser.username," has created successfully. please log in"));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){return Object(P.jsx)(H,{title:"Create Account",children:Object(P.jsxs)(S.a,Object(y.a)(Object(y.a)({},L),{},{name:"basic",initialValues:{remember:!0},onFinish:M,layout:"vertical",children:[Object(P.jsx)(S.a.Item,{label:"Username",name:"username",rules:[{required:!0,message:"Please input your username!"}],children:Object(P.jsx)(C.a,{placeholder:"enter a username"})}),Object(P.jsx)(S.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}],children:Object(P.jsx)(C.a.Password,{placeholder:"enter a password"})}),Object(P.jsx)(S.a.Item,Object(y.a)(Object(y.a)({},F),{},{children:Object(P.jsxs)(I.a,{children:[Object(P.jsx)(A.a,{span:12,children:Object(P.jsx)(U.a,{type:"primary",htmlType:"submit",block:!0,children:"Register"})}),Object(P.jsx)(A.a,{span:12,children:Object(P.jsx)(v.b,{to:"/login",children:Object(P.jsx)(U.a,{block:!0,children:"Login"})})})]})}))]}))})},W=n(125),R=n(170),z=n(296),G=n(168),q=n(169),J=function(){function e(){Object(G.a)(this,e),this.socket=null,this.hooks={}}return Object(q.a)(e,[{key:"connect",value:function(e,t){var n=this;if(this.socket)return!1;this.socket=new WebSocket("ws://"+window.location.host),this.socket.addEventListener("open",(function(s){console.log("Connected to WS Server");var a=e.isAdmin,c=e.username,r=e._id;n.emitMessage("set_user",{isAdmin:a,username:c,_id:r}),t()})),this.socket.addEventListener("message",(function(e){try{var t=JSON.parse(e.data);n.hooks[t.type]&&n.hooks[t.type](t.payload)}catch(s){console.log("invalid data",s,e.data)}})),this.socket.addEventListener("close",(function(s){console.log("Socket is closed. Reconnect will be attempted in 1 second.",s.reason),n.socket=null,setTimeout((function(){n.connect(e,t)}),1e3)}))}},{key:"emitMessage",value:function(e,t){var n=this;this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify({type:e,payload:t})):setTimeout((function(){n.emitMessage(e,t)}),500)}},{key:"sendMessage",value:function(e,t,n){this.emitMessage("user_message",{sessionId:t,username:e.username,isAdmin:e.isAdmin,message:n})}},{key:"updatePoints",value:function(e,t){this.emitMessage("update_points",{sessionId:e,points:t})}},{key:"addHook",value:function(e,t){this.hooks[e]=t}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),Y=n(295),B=function(e){var t=e.setSession,n=Object(s.useState)(!0),a=Object(l.a)(n,2),c=a[0],r=a[1],i=localStorage.getItem("auth-token"),j=Object(s.useState)(""),b=Object(l.a)(j,2),d=b[0],h=b[1];return Object(P.jsx)(P.Fragment,{children:Object(P.jsx)(Y.a,{title:"Enter a Session Code",visible:c,maskClosable:!1,onOk:Object(u.a)(o.a.mark((function e(){var n,s,a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.get("session/"+d,{token:i});case 2:n=e.sent,s=Object(l.a)(n,2),a=s[0],c=s[1],a?w.b.error("Something went wrong"):c.session?(t(c.session),r(!1)):w.b.info("No found the Session. Please check and retry");case 7:case"end":return e.stop()}}),e)}))),onCancel:function(){return r(!0)},children:Object(P.jsx)(C.a,{value:d,onChange:function(e){return h(e.target.value)}})})})},K=n(85),V=n.n(K),Q=null,X=function(e){var t=e.user,n=e.setUser,a=Object(s.useState)(0),c=Object(l.a)(a,2),r=c[0],i=c[1],o=Object(s.useState)(""),u=Object(l.a)(o,2),j=u[0],b=u[1],h=Object(s.useState)(null),O=Object(l.a)(h,2),f=O[0],m=O[1],p=Object(k.g)();return Object(s.useEffect)((function(){t&&((Q=J.getInstance()).connect(t,(function(){console.log("websocket connected")})),Q.addHook("user_message",(function(e){m(Object(y.a)(Object(y.a)({},f),{},{messages:[].concat(Object(W.a)(f.messages),[e])}))})),Q.addHook("changed_points",(function(e){m(Object(y.a)(Object(y.a)({},f),{},{points:e})),i(e[t._id])})))}),[t,f]),Object(s.useEffect)((function(){f&&i(d(f,["points",t._id]))}),[f]),t?f?Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(I.a,{style:{marginTop:100},children:Object(P.jsx)(A.a,{span:4,offset:20,children:Object(P.jsx)(U.a,{onClick:function(){p.push("/"),localStorage.setItem("auth-token",""),n(null)},children:"Logout"})})}),Object(P.jsxs)(I.a,{children:[Object(P.jsx)(A.a,{span:6,offset:9,children:Object(P.jsxs)("p",{style:{textAlign:"center"},children:["Session ID: ",f.id]})}),Object(P.jsx)(A.a,{span:6,offset:9,children:Object(P.jsx)(C.a,{value:t.username,style:{textAlign:"center"}})})]}),Object(P.jsx)(I.a,{style:{marginTop:20},children:Object(P.jsx)(A.a,{span:6,offset:9,children:Object(P.jsx)(C.a,{value:r,style:{textAlign:"center"}})})}),Object(P.jsx)(I.a,{style:{marginTop:20},children:Object(P.jsx)(A.a,{span:12,offset:6,children:Object(P.jsx)("div",{style:{minHeight:200,maxHeight:"70vh",overflow:"auto"},children:f.messages.filter((function(e){var n=e.username;return e.isAdmin||n===t.username})).map((function(e){var t=e.username,n=e.isAdmin,s=e.message,a=e.time;return Object(P.jsxs)("div",{children:[Object(P.jsx)(z.a,{color:"default",children:n?"Admin":t}),": (",V()(a).format("HH:mm:ss"),")"," ",s]},a)}))})})}),Object(P.jsxs)(I.a,{style:{marginTop:20},children:[Object(P.jsx)(A.a,{span:10,offset:6,children:Object(P.jsx)(C.a,{value:j,onChange:function(e){return b(e.target.value)}})}),Object(P.jsx)(A.a,{span:2,children:Object(P.jsx)(U.a,{style:{marginLeft:5},type:"primary",block:!0,disabled:""===j,onClick:function(){Q.sendMessage(t,f.id,j),b("")},children:"SEND"})})]})]}):Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)("div",{children:"Select a Session"}),Object(P.jsx)(B,{setSession:m})]}):Object(P.jsx)(R.a,{})},Z=n(290),$=n(73),ee=n(182),te=n(110),ne=n(293),se=n(297),ae=n(298),ce=function(e){var t=e.username,n=e.totalPoint,a=e.userId,c=e.setTotalPoint,r=e.setNumber,i=Object(s.useState)(0),o=Object(l.a)(i,2),u=o[0],j=o[1];return Object(s.useEffect)((function(){j(r)}),[r]),Object(P.jsxs)(I.a,{children:[Object(P.jsx)(A.a,{span:8,style:{display:"flex",alignItems:"center",textAlign:"right"},children:t}),Object(P.jsxs)(A.a,{span:16,style:{display:"flex",alignItems:"center"},children:[Object(P.jsx)(ne.a,{style:{maxWidth:50,marginRight:5},min:0,value:u,onChange:function(e){return j(e)}}),Object(P.jsx)(U.a,{icon:Object(P.jsx)(se.a,{}),onClick:function(){return c((n||0)+u,a)},size:"small"}),Object(P.jsx)(U.a,{icon:Object(P.jsx)(ae.a,{}),onClick:function(){return c((n||0)-u,a)},size:"small"}),Object(P.jsx)(z.a,{style:{marginLeft:5,marginRight:0},color:"volcano",children:n||0})]})]})},re=function(e){var t=e.onlineUsers,n=e.session,a=e.setSession,c=e.allUsers,r=e.onScoreUpdate,i=Object(s.useState)(0),o=Object(l.a)(i,2),u=o[0],j=o[1],b=Object(s.useState)(0),h=Object(l.a)(b,2),O=h[0],f=h[1],m=t.reduce((function(e,t){return e[t.username]=t,e}),{});return Object(P.jsxs)("div",{children:[Object(P.jsxs)(A.a,{style:{display:"flex",alignItems:"center"},span:16,offset:8,children:[Object(P.jsx)(ne.a,{style:{maxWidth:50,marginRight:5},value:u,onChange:function(e){return j(e)},min:0}),Object(P.jsx)(U.a,{size:"small",onClick:function(){f(u)},children:"SET"})]}),c.filter((function(e){return!e.isAdmin&&!!m[e.username]})).map((function(e){return Object(P.jsx)(ce,{setNumber:O,userId:e._id,username:e.username,totalPoint:d(n,["points",e._id]),setTotalPoint:function(e,t){a(Object(y.a)(Object(y.a)({},n),{},{points:Object(y.a)(Object(y.a)({},n.points),{},Object(te.a)({},t,e))}))}})})),Object(P.jsx)("div",{style:{marginTop:10},children:Object(P.jsx)(U.a,{type:"primary",onClick:r,children:"Update"})})]})},ie=n(291),oe=function(e){var t=e.setSession,n=Object(s.useState)(!0),a=Object(l.a)(n,2),c=a[0],r=a[1],i=localStorage.getItem("auth-token"),j=Object(s.useState)([]),b=Object(l.a)(j,2),d=b[0],h=b[1];return Object(s.useEffect)((function(){Object(u.a)(o.a.mark((function e(){var t,n,s,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.get("session",{token:i});case 2:if(t=e.sent,n=Object(l.a)(t,2),s=n[0],a=n[1],!s){e.next=8;break}return e.abrupt("return",w.b.error(s.msg||s.error.msg||"Something Went Wrong"));case 8:h(a.sessions);case 9:case"end":return e.stop()}}),e)})))()}),[]),Object(P.jsx)(P.Fragment,{children:Object(P.jsx)(Y.a,{title:"Create A New Game",visible:c,onOk:function(){return r(!0)},onCancel:function(){return r(!0)},maskClosable:!1,children:Object(P.jsx)(ie.a,{dataSource:d,columns:[{title:"Started At",dataIndex:"createdAt",render:function(e){return V()(e).format("YYYY-MM-DD  HH:mm")}},{title:"ID",dataIndex:"id"}],pagination:{position:["none","none"]},rowKey:"_id",onRow:function(e){return{onClick:function(){var n=Object(u.a)(o.a.mark((function n(){var s,a,c,u;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,x.get("session/"+e._id,{token:i});case 2:if(s=n.sent,a=Object(l.a)(s,2),c=a[0],u=a[1],!c){n.next=8;break}return n.abrupt("return",w.b.error("Something went wrong"));case 8:t(u.session),r(!1);case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}()}}})})})},ue=Z.a.Header,le=Z.a.Content,je=Z.a.Footer,be=null,de=function(e){var t=e.session,n=e.setSession,a=e.onLogout,c=Object(s.useState)(!1),r=Object(l.a)(c,2),i=r[0],j=r[1],b=Object(s.useState)(Object(ee.a)(6)),d=Object(l.a)(b,2),h=d[0],O=d[1],f=localStorage.getItem("auth-token"),m=function(){var e=Object(u.a)(o.a.mark((function e(){var t,s,a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.post("session",{id:h},{token:f});case 2:if(t=e.sent,s=Object(l.a)(t,2),a=s[0],c=s[1],!a){e.next=8;break}return e.abrupt("return",w.b.error(a.msg||a.error.msg||"Something Went Wrong"));case 8:w.b.success("Game Create with Game ID: ".concat(h)),w.b.info("Please share this game ID with others to join"),n(c.newSession),j(!1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(P.jsxs)($.a,{theme:"dark",mode:"horizontal",selectedKeys:[],selectable:!1,children:[Object(P.jsx)($.a.Item,{onClick:function(){return j(!0)},children:"Create A New Game"},1),Object(P.jsx)($.a.Item,{style:{float:"right"},onClick:a,children:"Logout"},3),Object(P.jsxs)($.a.Item,{style:{float:"right"},children:["key: ",t&&t.id||"N/A"]},2),Object(P.jsx)(Y.a,{title:"Create A New Game",visible:i,onOk:m,onCancel:function(){return j(!1)},children:Object(P.jsx)(C.a,{value:h,onChange:function(e){return O(e.target.value)}})})]})},he=function(e){var t=e.user,n=e.setUser,a=localStorage.getItem("auth-token"),c=Object(k.g)(),r=Object(s.useState)(null),i=Object(l.a)(r,2),j=i[0],b=i[1],d=Object(s.useState)([]),h=Object(l.a)(d,2),O=h[0],f=h[1],m=Object(s.useState)([]),p=Object(l.a)(m,2),g=p[0],v=p[1];t&&!t.isAdmin&&(c.push("/"),w.b.error("Access Denied"),n(null)),Object(s.useEffect)((function(){t&&((be=J.getInstance()).connect(t,(function(){console.log("websocket connected")})),be.addHook("user_message",(function(e){b(Object(y.a)(Object(y.a)({},j),{},{messages:[].concat(Object(W.a)(j.messages),[e])}))})),be.addHook("user_changed",(function(e){f(e)})))}),[t,j]),Object(s.useEffect)((function(){Object(u.a)(o.a.mark((function e(){var t,n,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.get("users/all-users",{token:a});case 2:if(t=e.sent,n=Object(l.a)(t,2),s=n[0],c=n[1],!s){e.next=8;break}return e.abrupt("return",w.b.error("Something went wrong, please refresh the page"));case 8:v(c.users);case 9:case"end":return e.stop()}}),e)})))()}),[]);var S=Object(s.useState)(""),H=Object(l.a)(S,2),T=H[0],E=H[1];return Object(P.jsxs)(Z.a,{style:{height:"100vh"},children:[Object(P.jsxs)(ue,{style:{position:"fixed",zIndex:1,width:"100%"},children:[Object(P.jsx)("div",{className:"logo"}),Object(P.jsx)(de,{setSession:b,session:j,onLogout:function(){c.push("/"),localStorage.setItem("auth-token",""),n(null)}})]}),Object(P.jsx)(le,{className:"site-layout",style:{padding:"0 50px",marginTop:64},children:Object(P.jsx)("div",{className:"site-layout-background",style:{padding:24,minHeight:380},children:j&&Object(P.jsx)(I.a,{children:Object(P.jsx)(A.a,{span:20,offset:2,children:Object(P.jsxs)(I.a,{children:[Object(P.jsxs)(A.a,{span:17,children:[Object(P.jsx)("div",{style:{minHeight:500,maxHeight:"70vh",overflow:"auto"},children:j.messages.map((function(e){var t=e.username,n=e.isAdmin,s=e.message,a=e.time;return Object(P.jsxs)("div",{children:[Object(P.jsx)(z.a,{color:"default",children:n?"Admin":t}),": (",V()(a).format("HH:mm:ss"),")"," ",s]},a)}))}),Object(P.jsxs)(I.a,{style:{marginTop:20},children:[Object(P.jsx)(A.a,{span:20,children:Object(P.jsx)(C.a,{value:T,onChange:function(e){return E(e.target.value)}})}),Object(P.jsx)(A.a,{span:4,children:Object(P.jsx)(U.a,{style:{marginLeft:5},type:"primary",block:!0,disabled:""===T,onClick:function(){be.sendMessage(t,j.id,T),E("")},children:"SEND"})})]})]}),Object(P.jsx)(A.a,{span:6,offset:1,children:Object(P.jsx)(re,{onlineUsers:O,session:j,setSession:b,allUsers:g,onScoreUpdate:function(){be.updatePoints(j.id,j.points)}})})]})})})})}),Object(P.jsx)(je,{style:{textAlign:"center"}}),!j&&Object(P.jsx)(oe,{setSession:b})]})},Oe=function(e){var t=e.user,n=e.setUser;return Object(P.jsx)(v.a,{children:Object(P.jsxs)(k.d,{children:[Object(P.jsx)(k.b,{path:"/home",children:Object(P.jsx)(_,{user:t,setUser:n})}),Object(P.jsx)(k.b,{path:"/signup",children:Object(P.jsx)(D,{user:t,setUser:n})}),Object(P.jsx)(k.b,{path:"/admin",children:Object(P.jsx)(he,{user:t,setUser:n})}),Object(P.jsx)(k.b,{path:"/user-dashboard",children:Object(P.jsx)(X,{user:t,setUser:n})}),Object(P.jsx)(k.b,{path:"/",children:Object(P.jsx)(k.a,{to:"/home"})})]})})};var fe=function(){var e=Object(s.useState)(!1),t=Object(l.a)(e,2),n=(t[0],t[1]),a=Object(s.useState)(null),c=Object(l.a)(a,2),r=c[0],i=c[1],j=localStorage.getItem("auth-token")||"";return Object(s.useEffect)((function(){Object(u.a)(o.a.mark((function e(){var t,s,a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(!0),e.next=3,x.get("users/validate",{token:j});case 3:t=e.sent,s=Object(l.a)(t,2),a=s[0],c=s[1],i(a?null:c.user),n(!1);case 9:case"end":return e.stop()}}),e)})))()}),[]),Object(P.jsx)("div",{className:"App",children:Object(P.jsx)(Oe,{user:r,setUser:i})})},me=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,299)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),s(e),a(e),c(e),r(e)}))};r.a.render(Object(P.jsx)(a.a.StrictMode,{children:Object(P.jsx)(fe,{})}),document.getElementById("root")),me()}},[[285,1,2]]]);